ğŸ“Œ Required TSP Configuration

Create a Transaction Security Policy:

Step 1: Setup â†’ Transaction Security â†’ New Policy
Step 2: Event Type â†’ Login Event
Step 3: Condition â†’
Risk Level Equals HIGH
AND
User.ProfileName CONTAINS "Retailer"

Step 4: Action â†’ Invoke Apex Class

Select:
RetailerAnomalyHandler

(Optional)

Enable:
âœ” Block login
âœ” Require MFA
âœ” Logout user

âš  Sandbox Notes

Since you asked earlier:

â— Sandbox anomaly scoring is OFF.

So TSP with â€œRiskLevel = HIGHâ€ will not fire in Sandbox.

But the solution works perfectly in Production.